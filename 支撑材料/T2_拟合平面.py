import numpy as np
import matplotlib.pyplot as plt
from mpl_toolkits.mplot3d import Axes3D

# 平面拟合 及方差计算 通用模板
x = [172.5849703361308, 130.31053186487503, 129.8999963197148, 87.40951707533729, 86.73545784686141, 86.42219856743965, 43.238240083571775, 43.537671588762926, 42.907286891592236, 44.11251663622844, 0.9524770522945771, -0.1031730146858596, -0.5529740507383931, 0.9332149292996521, 0.5418555762004413]
y = [ 0.9743774126537483, 24.913086330612813, -25.876708996208606, 50.12316376755098, 0.9951782205496467, -49.52174747162192, 74.01871209180575, 24.16558240521679, -24.879408055333283, -74.73222042176403, 100.47725589932327, 49.4965680599237, -0.9345715613262222, -49.18974689256766, -100.58430167340168]
z = [ 0.11417707355129991, 0.49355928755122647, -0.14568634413313086, -0.07856198814204896, -0.8102178515140541, -0.7485911377795991, 0.7737870283715225, 0.7855557667588986, -0.22617781561841177, -0.5406072425582142, -0.5414806627246775, -0.2270074255766248, -0.15826725127853036, -0.0203398482543673, 0.7177759516825288]

lst_x_final = [ 172.5849703361308, 129.66053186487505, 129.56999631971482, 86.75951707533733, 86.66545784686141, 86.55219856743966, 43.868240083571784, 43.75767158876292, 43.65728689159224, 43.542516636228434, 0.9624770522945771, 0.8568269853141403, 0.7570259492616065, 0.6432149292996521, 0.5418555762004409]
lst_y_final = [ 0.9743774126537483, 25.873086330612818, -23.736708996208584, 50.76316376755098, 1.1551782205496468, -48.451747471621914, 75.64871209180566, 26.055582405216814, -23.559408055333265, -73.16222042176412, 100.53725589932327, 50.94656805992372, 1.3254284386737778, -48.25974689256765, -97.86430167340184]
lst_z_final = [ 0.11417707355129991, -0.046440712448773507, 0.26431365586686917, -0.21856198814204897, -0.1502178515140542, 0.4114088622204009, -0.37621297162847744, 0.12555576675889865, -0.10617781561841173, 0.5593927574417857, -0.5414806627246775, -0.2270074255766248, 0.08173274872146966, 0.39966015174563274, 0.7077759516825288]

x = lst_x_final
y = lst_y_final
z = lst_z_final

# 创建系数矩阵A
a = 0
A = np.ones((15, 3))
for i in range(0, 15):
    A[i, 0] = x[a]
    A[i, 1] = y[a]
    a = a + 1
# print(A)

# 创建矩阵b
b = np.zeros((15, 1))
a = 0
for i in range(0, 15):
    b[i, 0] = z[a]
    a = a + 1

A_T = A.T
A1 = np.dot(A_T, A)
A2 = np.linalg.inv(A1)
A3 = np.dot(A2, A_T)
X = np.dot(A3, b)
print('平面拟合结果为：z = %.3f * x + %.3f * y + %.3f' % (X[0, 0], X[1, 0], X[2, 0]))

# 计算方差
R = 0
for i in range(0, 15):
    R = R + (X[0, 0] * x[i] + X[1, 0] * y[i] + X[2, 0] - z[i]) ** 2
print('方差为：%.*f' % (3, R))

# 展示图像
fig1 = plt.figure()
ax1 = fig1.add_subplot(111, projection='3d')
ax1.set_xlabel("x")
ax1.set_ylabel("y")
ax1.set_zlabel("z")
ax1.scatter(x, y, z, c='r', marker='o')
x_p = np.linspace(0,173, 100)
y_p = np.linspace(-100,100, 100)
x_p, y_p = np.meshgrid(x_p, y_p)
z_p = X[0, 0] * x_p + X[1, 0] * y_p + X[2, 0]
ax1.plot_wireframe(x_p, y_p, z_p, rstride=10, cstride=10)
ax1.view_init(50, 30)
plt.savefig('.\\平面拟合检验.png', dpi=1000)
plt.show()
